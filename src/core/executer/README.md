                    ┌────────────────────────┐
                    │  VISITAR NÓ COMMAND    │
                    └──────────────┬─────────┘
                                   │
                                   ▼
                     ┌────────────────────────┐
                     │ 1. EXPANDIR ARGUMENTOS │
                     │ - variáveis ($VAR)     │
                     │ - globs (*)            │
                     │ - remover quotes       │
                     │ - construir argv       │
                     └──────────────┬─────────┘
                                   │
                                   ▼
                     ┌────────────────────────┐
                     │ 2. APLICAR REDIRECTS   │
                     │ abrir arquivos         │
                     │ dup2() para STDIN/OUT  │
                     │ erros? → abortar cmd   │
                     └──────────────┬─────────┘
                                   │
                                   ▼
           ┌───────────────────────────────────────────────────┐
           │ 3. É BUILTIN?                                     │
           └───────────────────────┬───────────────────────────┘
                                   │
                   ┌───────────────┴───────────────┐
                   ▼                               ▼
        ┌──────────────────┐             ┌────────────────────────┐
        │ SIM, É BUILTIN   │             │ NÃO, É COMANDO EXTERNO │
        └──────────┬──────┘              └────────────┬───────────┘
                   │                                 │
                   ▼                                 ▼
 ┌────────────────────────────────────┐   ┌───────────────────────────────────┐
 │ 4A. ESTÁ DENTRO DE UM PIPE?        │   │ 4B. CRIAR FILHO COM fork()        │
 └───────────────┬────────────────────┘   └──────────────────────┬────────────┘
                 │                                             (pai espera)
     ┌───────────┴────────────┐                       ┌───────────┴────────────┐
     ▼                        ▼                       ▼                        ▼
┌───────────────┐     ┌────────────────────┐   ┌───────────────────┐  ┌─────────────────────┐
│ NÃO → EXECUTA │     │ SIM → EXECUTA NO   │   │ FILHO: execve(...)│  │ PAI: waitpid()      │
│ NO PAI         │    │ FILHO (em um fork) │   │ (ou builtin in pip│  │ atualiza $?         │
└───┬────────────┘    └─────────┬──────────┘   └─────────────┬────┘   └──────────────┬──────┘
    │                           │                            │                       │
    ▼                           ▼                            ▼                       ▼
┌───────────────┐       ┌──────────────────┐         ┌───────────────────┐  ┌─────────────────────┐
│ run_builtin() │       │ fork() → filho   │         │ se execve falhar  │  │ retornar $? final   │
│ atualiza $?   │       │ roda builtin     │         │ exit(1)           │  │                     │
└───────────────┘       └──────────────────┘         └───────────────────┘  └─────────────────────┘
